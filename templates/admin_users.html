{% extends "base_app.html" %}
{% block title %}Kelola User - Koperasi{% endblock %}

{% block content %}
  <div class="mb-6">
    <h1 class="text-2xl font-extrabold text-white drop-shadow">ğŸ‘¥ Kelola User</h1>
    <p class="text-white/80 mt-1">Atur role dan permissions untuk semua user yang terdaftar.</p>
  </div>

  {% if users %}
    <div class="rounded-3xl bg-white/95 backdrop-blur border border-white/40 shadow-2xl overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-900 text-white sticky top-0">
            <tr>
              <th class="text-left px-4 py-4 font-bold text-xs uppercase">ID</th>
              <th class="text-left px-4 py-4 font-bold text-xs uppercase">Nama & Akun</th>
              <th class="text-left px-4 py-4 font-bold text-xs uppercase">Kontak</th>
              <th class="text-center px-4 py-4 font-bold text-xs uppercase">Status Verifikasi</th>
              <th class="text-center px-4 py-4 font-bold text-xs uppercase">Role</th>
              <th class="text-center px-4 py-4 font-bold text-xs uppercase">Action</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100">
            {% for user in users %}
            <tr class="hover:bg-slate-50 transition-colors border-l-4 border-transparent hover:border-purple-500">
              <td class="px-4 py-4 font-bold text-slate-900">{{ user.id }}</td>
              <td class="px-4 py-4">
                <div class="font-medium text-slate-800">{{ user.nama }}</div>
                <div class="text-xs font-mono text-purple-600 bg-purple-50 px-1.5 rounded inline-block">@{{ user.username }}</div>
              </td>
              <td class="px-4 py-4">
                <div class="text-xs text-slate-600">{{ user.email }}</div>
                <div class="text-xs text-slate-500">{{ user.telepon }}</div>
              </td>
              <td class="px-4 py-4 text-center">
                {% if user.is_verified %}
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200">
                    âœ… Verified
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-yellow-100 text-yellow-700 border border-yellow-200 animate-pulse">
                    â³ Pending
                  </span>
                {% endif %}
              </td>
              <td class="px-4 py-4 text-center">
                {% if user.role == "admin" %}
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 border border-red-200">
                    ğŸ‘‘ Admin
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-700 border border-blue-200">
                    ğŸ‘¤ User
                  </span>
                {% endif %}
              </td>
              <td class="px-4 py-4">
                <div class="flex gap-2 justify-center">
                  {% if user.username != session.get('username') %}
                    
                    {% if not user.is_verified %}
                      <a href="{{ url_for('admin_approve_user', user_id=user.id) }}" 
                         class="px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-xs font-bold rounded-lg shadow-sm transition-transform hover:scale-105"
                         onclick="return confirm('Setujui dokumen {{ user.nama }}?');">
                        Setujui
                      </a>
                    {% else %}
                      <a href="{{ url_for('admin_reject_user', user_id=user.id) }}" 
                         class="px-3 py-1.5 bg-orange-500 hover:bg-orange-600 text-white text-xs font-bold rounded-lg shadow-sm transition-transform hover:scale-105"
                         onclick="return confirm('Batalkan verifikasi {{ user.nama }}?');">
                        Batalkan
                      </a>
                    {% endif %}

                    <a href="{{ url_for('admin_set_role', user_id=user.id, role='admin' if user.role == 'user' else 'user') }}" 
                       class="px-3 py-1.5 bg-slate-700 hover:bg-slate-800 text-white text-xs font-bold rounded-lg shadow-sm transition-transform hover:scale-105">
                       {% if user.role == 'user' %} Jadi Admin {% else %} Jadi User {% endif %}
                    </a>

                    <a href="{{ url_for('admin_delete_user', user_id=user.id) }}" 
                       class="px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded-lg shadow-sm transition-transform hover:scale-105"
                       onclick="return confirm('Hapus user {{ user.nama }}?');">
                       ğŸ—‘ï¸
                    </a>

                  {% else %}
                    <span class="text-xs text-slate-400 italic">Akun Anda</span>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="rounded-2xl bg-white/80 backdrop-blur border border-white/30 shadow p-12 text-center">
      <p class="text-slate-600 text-lg font-medium">ğŸ‘¥ Tidak ada data pengguna untuk ditampilkan.</p>
    </div>
  {% endif %}
{% endblock %}
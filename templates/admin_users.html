{% extends "base_app.html" %}
{% block title %}Kelola User - Koperasi{% endblock %}

{% block content %}
  <div class="mb-6">
    <h1 class="text-2xl font-extrabold text-white drop-shadow">ğŸ‘¥ Kelola User</h1>
    <p class="text-white/80 mt-1">Atur role dan permissions untuk semua user.</p>
  </div>

  {% if users %}
    <div class="rounded-3xl bg-gradient-to-b from-white/95 to-white/80 backdrop-blur border border-white/40 shadow-2xl overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-gradient-to-r from-slate-900 to-slate-800 text-white sticky top-0">
            <tr>
              <th class="text-left px-4 py-4 font-extrabold text-xs uppercase tracking-wider">ID</th>
              <th class="text-left px-4 py-4 font-extrabold text-xs uppercase tracking-wider">Nama</th>
              <th class="text-left px-4 py-4 font-extrabold text-xs uppercase tracking-wider">Username</th>
              <th class="text-left px-4 py-4 font-extrabold text-xs uppercase tracking-wider">Email</th>
              <th class="text-left px-4 py-4 font-extrabold text-xs uppercase tracking-wider">Telepon</th>
              <th class="text-center px-4 py-4 font-extrabold text-xs uppercase tracking-wider">Status</th>
              <th class="text-center px-4 py-4 font-extrabold text-xs uppercase tracking-wider">Role</th>
              <th class="text-left px-4 py-4 font-extrabold text-xs uppercase tracking-wider">Action</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100">
            {% for user in users %}
            <tr class="hover:bg-gradient-to-r hover:from-purple-50 hover:to-blue-50 transition-all duration-200 border-l-4 border-transparent hover:border-purple-500">
              <td class="px-4 py-4 font-bold text-slate-900 text-sm">{{ user.id }}</td>
              <td class="px-4 py-4 text-slate-800 font-medium">{{ user.nama }}</td>
              <td class="px-4 py-4 text-slate-700 font-mono text-xs bg-slate-100 rounded px-2 py-1 inline-block">{{ user.username }}</td>
              <td class="px-4 py-4 text-slate-600 text-xs">{{ user.email }}</td>
              <td class="px-4 py-4 text-slate-600 text-xs">{{ user.telepon }}</td>
              <td class="px-4 py-4 text-center">
                {% if user.is_verified %}
                  <span class="inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold bg-gradient-to-r from-green-100 to-green-50 text-green-700 border border-green-200">
                    âœ… Verified
                  </span>
                {% else %}
                  <span class="inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold bg-gradient-to-r from-yellow-100 to-yellow-50 text-yellow-700 border border-yellow-200 animate-pulse">
                    â³ Pending
                  </span>
                {% endif %}
              </td>
              <td class="px-4 py-4 text-center">
                {% if user.role == "admin" %}
                  <span class="inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold bg-gradient-to-r from-red-100 to-red-50 text-red-700 border border-red-200">
                    ğŸ‘‘ Admin
                  </span>
                {% else %}
                  <span class="inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold bg-gradient-to-r from-blue-100 to-blue-50 text-blue-700 border border-blue-200">
                    ğŸ‘¤ User
                  </span>
                {% endif %}
              </td>
              <td class="px-4 py-4">
                <div class="flex gap-1.5 items-center">
                  <!-- Approve/Reject Button -->
                  {% if user.username != session.get('username') %}
                    {% if not user.is_verified %}
                      <a href="{{ url_for('admin_approve_user', user_id=user.id) }}" 
                         class="inline-flex items-center gap-1 px-2.5 py-1.5 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white text-xs font-bold rounded-lg transition-all duration-200 shadow hover:shadow-lg transform hover:scale-105"
                         title="Approve user"
                         onclick="return confirm('Approve user {{ user.username }}?');">
                        âœ… Acc
                      </a>
                    {% else %}
                      <a href="{{ url_for('admin_reject_user', user_id=user.id) }}" 
                         class="inline-flex items-center gap-1 px-2.5 py-1.5 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white text-xs font-bold rounded-lg transition-all duration-200 shadow hover:shadow-lg transform hover:scale-105"
                         title="Reject user"
                         onclick="return confirm('Tolak user {{ user.username }}?');">
                        â›” Tolak
                      </a>
                    {% endif %}
                  {% else %}
                    <span class="inline-flex items-center px-2.5 py-1.5 bg-gray-200 text-gray-600 text-xs font-bold rounded-lg">
                      Akun Anda
                    </span>
                  {% endif %}

                  <!-- Change Role Button -->
                  {% if user.username != session.get('username') %}
                    {% if user.role == "user" %}
                      <a href="{{ url_for('admin_set_role', user_id=user.id, role='admin') }}" 
                         class="inline-flex items-center gap-1 px-2.5 py-1.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white text-xs font-bold rounded-lg transition-all duration-200 shadow hover:shadow-lg transform hover:scale-105"
                         title="Make Admin"
                         onclick="return confirm('Ubah role menjadi Admin?');">
                        ğŸ‘‘ Admin
                      </a>
                    {% else %}
                      <a href="{{ url_for('admin_set_role', user_id=user.id, role='user') }}" 
                         class="inline-flex items-center gap-1 px-2.5 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-xs font-bold rounded-lg transition-all duration-200 shadow hover:shadow-lg transform hover:scale-105"
                         title="Make User"
                         onclick="return confirm('Turunkan role menjadi User?');">
                        ğŸ‘¤ User
                      </a>
                    {% endif %}
                  {% endif %}

                  <!-- Delete Button -->
                  {% if user.username != session.get('username') %}
                    <a href="{{ url_for('admin_delete_user', user_id=user.id) }}" 
                       class="inline-flex items-center gap-1 px-2.5 py-1.5 bg-gradient-to-r from-red-700 to-red-800 hover:from-red-800 hover:to-red-900 text-white text-xs font-bold rounded-lg transition-all duration-200 shadow hover:shadow-lg transform hover:scale-105"
                       title="Delete user"
                       onclick="return confirm('Hapus user ini? Tidak bisa dibatalkan!');">
                      ğŸ—‘ï¸ Hapus
                    </a>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="rounded-2xl bg-white/80 backdrop-blur border border-white/30 shadow p-12 text-center">
      <p class="text-slate-600 text-lg">ğŸ‘¥ Tidak ada user.</p>
    </div>
  {% endif %}
{% endblock %}
